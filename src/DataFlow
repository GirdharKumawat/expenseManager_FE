# Expense Manager Application - Data Flow Analysis

## ðŸ“‹ Overview
This document outlines the complete data flow for different scenarios in the Expense Manager React application, including authentication, expense management, and component interactions.

## ðŸ—ï¸ Application Architecture

### Core Structure
```
src/
â”œâ”€â”€ App.jsx                    # Main app component with routing
â”œâ”€â”€ main.jsx                   # Entry point with Redux Provider
â”œâ”€â”€ axios.js                   # HTTP client with interceptors
â”œâ”€â”€ key.js                     # API endpoint configuration
â”œâ”€â”€ Store/
â”‚   â””â”€â”€ store.js              # Redux store configuration
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/                 # Authentication feature
â”‚   â”‚   â”œâ”€â”€ authSlice.js      # Auth Redux slice
â”‚   â”‚   â””â”€â”€ useAuth.js        # Auth custom hook
â”‚   â””â”€â”€ expenses/             # Expense management feature
â”‚       â”œâ”€â”€ expenseSlice.js   # Expense Redux slice
â”‚       â””â”€â”€ useExpense.js     # Expense custom hook
â”œâ”€â”€ app/                      # Page components
â”œâ”€â”€ components/               # Reusable components
â””â”€â”€ lib/                      # Utility functions
```

### Redux Store Structure
```javascript
{
  auth: {
    loading: boolean,
    isAuthenticated: boolean,
    id: number|null,
    username: string,
    email: string
  },
  expense: {
    loading: string,
    expenses: array
  }
}
```

## ðŸ” Authentication Flow

### 1. Application Startup Flow
```
main.jsx
â”œâ”€â”€ Creates Redux store
â”œâ”€â”€ Wraps App with Redux Provider
â””â”€â”€ Renders App component

App.jsx
â”œâ”€â”€ Sets up routing with React Router
â”œâ”€â”€ Defines protected and public routes
â”œâ”€â”€ Wraps protected routes with ProtectedComponents
â””â”€â”€ Provides layout components (HeadNavBar, BottomNavBar)
```

### 2. Protected Route Access Flow
```
User navigates to "/" (Home)
â”‚
â”œâ”€â”€ ProtectedComponents.jsx checks authentication
â”‚   â”œâ”€â”€ useSelector((state) => state.auth.isAuthenticated)
â”‚   â”œâ”€â”€ If NOT authenticated:
â”‚   â”‚   â”œâ”€â”€ Calls useAuth().checkAuth()
â”‚   â”‚   â”œâ”€â”€ checkAuth() â†’ axiosAPI.get("api/auth/isauthenticated/")
â”‚   â”‚   â”œâ”€â”€ If check fails â†’ navigate("/login")
â”‚   â”‚   â””â”€â”€ Shows loading spinner while checking
â”‚   â””â”€â”€ If authenticated â†’ renders children (Home component)
â”‚
â””â”€â”€ Home.jsx renders with expense data
```

### 3. Login Flow
```
Login.jsx
â”œâ”€â”€ Renders LoginForm component

LoginForm.jsx
â”œâ”€â”€ useState for username, password
â”œâ”€â”€ useSelector for loading, isAuthenticated from Redux
â”œâ”€â”€ useAuth() hook for loginUser function
â”œâ”€â”€ useNavigate for redirection
â”‚
â”œâ”€â”€ User submits form:
â”‚   â”œâ”€â”€ handleSubmit() calls loginUser({username, password})
â”‚   â”œâ”€â”€ loginUser() in useAuth.js:
â”‚   â”‚   â”œâ”€â”€ dispatch(setLoading(true))
â”‚   â”‚   â”œâ”€â”€ axiosAPI.post("api/auth/user/login/", credentials)
â”‚   â”‚   â”œâ”€â”€ On success:
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setLoading(false))
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setIsAuthenticated(true))
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setUser({id, username, email}))
â”‚   â”‚   â”‚   â””â”€â”€ toast.success("Login successful")
â”‚   â”‚   â””â”€â”€ On error:
â”‚   â”‚       â”œâ”€â”€ dispatch(setLoading(false))
â”‚   â”‚       â”œâ”€â”€ dispatch(setIsAuthenticated(false))
â”‚   â”‚       â””â”€â”€ toast.error("Login failed")
â”‚   â”‚
â”‚   â””â”€â”€ useEffect watches isAuthenticated:
â”‚       â””â”€â”€ If true â†’ navigate("/") to Home
â”‚
â””â”€â”€ Loading state shows spinner overlay
```

### 4. Signup Flow
```
Signup.jsx
â”œâ”€â”€ Renders SignupForm component

SignupForm.jsx
â”œâ”€â”€ useState for username, email, password
â”œâ”€â”€ useSelector for loading, isAuthenticated
â”œâ”€â”€ useAuth() hook for signupUser function
â”‚
â”œâ”€â”€ User submits form:
â”‚   â”œâ”€â”€ handleSubmit() calls signupUser({username, email, password})
â”‚   â”œâ”€â”€ signupUser() in useAuth.js:
â”‚   â”‚   â”œâ”€â”€ dispatch(setLoading(true))
â”‚   â”‚   â”œâ”€â”€ axiosAPI.post("api/auth/user/register/", credentials)
â”‚   â”‚   â”œâ”€â”€ On success:
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setLoading(false))
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setIsAuthenticated(true))
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setUser({id, username, email}))
â”‚   â”‚   â”‚   â””â”€â”€ toast.success("Sign up successful")
â”‚   â”‚   â””â”€â”€ On error:
â”‚   â”‚       â”œâ”€â”€ dispatch(setLoading(false))
â”‚   â”‚       â”œâ”€â”€ dispatch(setIsAuthenticated(false))
â”‚   â”‚       â””â”€â”€ toast.error("Sign up failed")
â”‚   â”‚
â”‚   â””â”€â”€ useEffect watches isAuthenticated:
â”‚       â””â”€â”€ If true â†’ navigate("/") to Home
â”‚
â””â”€â”€ Form resets after submission
```

### 5. Logout Flow
```
Account.jsx
â”œâ”€â”€ User clicks logout button
â”œâ”€â”€ handleLogout() calls useAuth().logoutUser()
â”œâ”€â”€ logoutUser() in useAuth.js:
â”‚   â”œâ”€â”€ axiosAPI.post("api/auth/user/logout/")
â”‚   â”œâ”€â”€ dispatch(setLoading(false))
â”‚   â”œâ”€â”€ dispatch(setIsAuthenticated(false))
â”‚   â”œâ”€â”€ dispatch(setUser({id: null, username: "", email: ""}))
â”‚   â”œâ”€â”€ toast.success("Logout successful")
â”‚   â””â”€â”€ navigate("/login")
â”‚
â””â”€â”€ User redirected to login page
```

## ðŸ’° Expense Management Flow

### 1. Home Page Initialization
```
Home.jsx renders
â”œâ”€â”€ useSelector to get expenses, loading from Redux
â”œâ”€â”€ useState for local state (filteredExpenses, category, paymentType, etc.)
â”œâ”€â”€ useExpense() hook for expense operations
â”‚
â”œâ”€â”€ useEffect on expenses:
â”‚   â”œâ”€â”€ If expenses.length <= 0:
â”‚   â”‚   â””â”€â”€ Call getExpenses()
â”‚   â””â”€â”€ getExpenses() in useExpense.js:
â”‚       â”œâ”€â”€ dispatch(setLoading("get"))
â”‚       â”œâ”€â”€ axiosAPI.get("api/get/expenses/")
â”‚       â”œâ”€â”€ On success:
â”‚       â”‚   â””â”€â”€ dispatch(setExpenses(data.data))
â”‚       â”œâ”€â”€ On error:
â”‚       â”‚   â””â”€â”€ toast.error("Error fetching expenses")
â”‚       â””â”€â”€ dispatch(setLoading(""))
â”‚
â”œâ”€â”€ useEffect for filtering:
â”‚   â”œâ”€â”€ Watches category, paymentType, expenses changes
â”‚   â”œâ”€â”€ Filters expenses based on selected criteria
â”‚   â””â”€â”€ Updates filteredExpenses state
â”‚
â””â”€â”€ Renders expense cards, statistics, and add expense drawer
```

### 2. Add Expense Flow
```
Home.jsx - Add Expense Button clicked
â”œâ”€â”€ openDrawer() sets isDrawerOpen to true
â”œâ”€â”€ Drawer opens with form fields:
â”‚   â”œâ”€â”€ Amount (number input)
â”‚   â”œâ”€â”€ Category (select dropdown)
â”‚   â”œâ”€â”€ Description (text input)
â”‚   â”œâ”€â”€ Date (date input)
â”‚   â””â”€â”€ Payment Method (radio buttons)
â”‚
â”œâ”€â”€ Form validation on submit:
â”‚   â”œâ”€â”€ validateForm() checks all required fields
â”‚   â”œâ”€â”€ Sets formErrors state if validation fails
â”‚   â””â”€â”€ Returns true/false for valid form
â”‚
â”œâ”€â”€ User clicks "Add Expense":
â”‚   â”œâ”€â”€ handleAddExpense() calls validateForm()
â”‚   â”œâ”€â”€ If valid:
â”‚   â”‚   â”œâ”€â”€ Calls postExpense(newExpense)
â”‚   â”‚   â”œâ”€â”€ postExpense() in useExpense.js:
â”‚   â”‚   â”‚   â”œâ”€â”€ dispatch(setLoading("add"))
â”‚   â”‚   â”‚   â”œâ”€â”€ axiosAPI.post("api/add/expense/", expenseData)
â”‚   â”‚   â”‚   â”œâ”€â”€ On success:
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ toast.success("Expense added successfully")
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ dispatch(addExpense(data.data))
â”‚   â”‚   â”‚   â”œâ”€â”€ On error:
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ toast.error("Error adding expense")
â”‚   â”‚   â”‚   â””â”€â”€ dispatch(setLoading(""))
â”‚   â”‚   â”œâ”€â”€ closeDrawer()
â”‚   â”‚   â””â”€â”€ resetForm()
â”‚   â””â”€â”€ If invalid: Shows validation errors
â”‚
â””â”€â”€ User clicks "Add & Continue":
    â”œâ”€â”€ Same validation and submission process
    â”œâ”€â”€ But keeps drawer open
    â””â”€â”€ Only resets form fields
```

### 3. Delete Expense Flow
```
ExpenseCard.jsx - Delete button clicked
â”œâ”€â”€ onDelete() prop called with expense.id
â”œâ”€â”€ deleteExpense(expense.id) in useExpense.js:
â”‚   â”œâ”€â”€ dispatch(setLoading("delete"))
â”‚   â”œâ”€â”€ axiosAPI.delete(`api/delete/expense/${expenseId}`)
â”‚   â”œâ”€â”€ On success:
â”‚   â”‚   â”œâ”€â”€ toast.success("Expense deleted successfully")
â”‚   â”‚   â””â”€â”€ dispatch(removeExpense(expenseId))
â”‚   â”œâ”€â”€ On error:
â”‚   â”‚   â””â”€â”€ toast.error("Error deleting expense")
â”‚   â””â”€â”€ dispatch(setLoading(""))
â”‚
â”œâ”€â”€ removeExpense in expenseSlice.js:
â”‚   â””â”€â”€ Filters out expense with matching ID from state
â”‚
â””â”€â”€ UI updates automatically via Redux state change
```

### 4. Expense Filtering Flow
```
Home.jsx - Filter controls
â”œâ”€â”€ Category dropdown change:
â”‚   â”œâ”€â”€ handleCategoryChange() updates category state
â”‚   â””â”€â”€ Triggers useEffect for filtering
â”‚
â”œâ”€â”€ Payment type dropdown change:
â”‚   â”œâ”€â”€ handlePaymentTypeChange() updates paymentType state
â”‚   â””â”€â”€ Triggers useEffect for filtering
â”‚
â”œâ”€â”€ useEffect([category, paymentType, expenses]):
â”‚   â”œâ”€â”€ Filters expenses array based on:
â”‚   â”‚   â”œâ”€â”€ category === "all" || expense.category === category
â”‚   â”‚   â””â”€â”€ paymentType === "all" || expense.paymentType === paymentType
â”‚   â””â”€â”€ Updates filteredExpenses state
â”‚
â””â”€â”€ ExpenseCard components re-render with filtered data
```

## ðŸ”„ HTTP Request Interceptor Flow

### Automatic Token Refresh
```
Any API request fails with 401 status
â”œâ”€â”€ axios.js response interceptor catches error
â”œâ”€â”€ Checks if:
â”‚   â”œâ”€â”€ error.response?.status === 401
â”‚   â”œâ”€â”€ !originalRequest._retry
â”‚   â””â”€â”€ Not an auth endpoint (login/register/refresh)
â”‚
â”œâ”€â”€ If refresh needed:
â”‚   â”œâ”€â”€ Sets isRefreshing flag to prevent multiple attempts
â”‚   â”œâ”€â”€ Marks originalRequest._retry = true
â”‚   â”œâ”€â”€ Calls axiosAPI.post("api/auth/token/refresh/")
â”‚   â”œâ”€â”€ On refresh success:
â”‚   â”‚   â””â”€â”€ Retries original request with axiosAPI(originalRequest)
â”‚   â”œâ”€â”€ On refresh failure:
â”‚   â”‚   â””â”€â”€ Redirects to window.location.href = "/login"
â”‚   â””â”€â”€ Always sets isRefreshing = false
â”‚
â””â”€â”€ Returns promise with retry result or rejection
```

## ðŸ§© Component Lifecycle Flows

### 1. Account Page Flow
```
Account.jsx initialization
â”œâ”€â”€ useAuth() hook provides logoutUser, fetchUser
â”œâ”€â”€ useSelector gets username, email from Redux
â”œâ”€â”€ useNavigate for redirection
â”‚
â”œâ”€â”€ useEffect on component mount:
â”‚   â”œâ”€â”€ If no username in state:
â”‚   â”‚   â””â”€â”€ Calls fetchUser()
â”‚   â””â”€â”€ fetchUser() in useAuth.js:
â”‚       â”œâ”€â”€ dispatch(setLoading(true))
â”‚       â”œâ”€â”€ axiosAPI.get("api/profile")
â”‚       â”œâ”€â”€ On success:
â”‚       â”‚   â”œâ”€â”€ dispatch(setUser(res.data.data))
â”‚       â”‚   â””â”€â”€ dispatch(setIsAuthenticated(true))
â”‚       â”œâ”€â”€ On 401 error:
â”‚       â”‚   â”œâ”€â”€ Tries refreshUser()
â”‚       â”‚   â”œâ”€â”€ If refresh succeeds: Retries profile fetch
â”‚       â”‚   â””â”€â”€ If refresh fails: Calls logoutUser()
â”‚       â””â”€â”€ dispatch(setLoading(false))
â”‚
â”œâ”€â”€ Renders user info if username exists
â”œâ”€â”€ Shows loading message if fetching
â””â”€â”€ Logout button triggers logout flow
```

### 2. Navigation Flow
```
BottomNavBar.jsx
â”œâ”€â”€ useLocation to get current path
â”œâ”€â”€ Renders NavLink components for each route:
â”‚   â”œâ”€â”€ Home (/)
â”‚   â”œâ”€â”€ Analysis (/analysis)
â”‚   â”œâ”€â”€ Budget (/budget)
â”‚   â””â”€â”€ Account (/account)
â”‚
â”œâ”€â”€ Each NavLink:
â”‚   â”œâ”€â”€ Highlights active route based on location.pathname
â”‚   â”œâ”€â”€ Uses React Router navigation
â”‚   â””â”€â”€ Triggers ProtectedComponents check for protected routes
â”‚
â””â”€â”€ Fixed position at bottom of screen
```

### 3. Loading States Flow
```
Various Loading Indicators:
â”‚
â”œâ”€â”€ Global Loading (Login/Signup):
â”‚   â”œâ”€â”€ Redux auth.loading state
â”‚   â”œâ”€â”€ Shows full-screen overlay with spinner
â”‚   â””â”€â”€ Blocks user interaction during auth operations
â”‚
â”œâ”€â”€ Expense Loading States:
â”‚   â”œâ”€â”€ "get": Shows skeleton cards while fetching expenses
â”‚   â”œâ”€â”€ "add": Shows "Adding..." on submit button
â”‚   â”œâ”€â”€ "delete": Shows deletion overlay
â”‚   â””â”€â”€ "": No loading state (normal operation)
â”‚
â””â”€â”€ Authentication Check Loading:
    â”œâ”€â”€ ProtectedComponents shows spinner
    â”œâ”€â”€ While validating authentication
    â””â”€â”€ Before rendering protected content
```

## ðŸ”§ Error Handling Flow

### 1. API Error Handling
```
API Request Fails
â”œâ”€â”€ axios interceptor catches error
â”œâ”€â”€ If 401 (Unauthorized):
â”‚   â”œâ”€â”€ Automatic token refresh attempt
â”‚   â”œâ”€â”€ Retry original request if refresh succeeds
â”‚   â””â”€â”€ Redirect to login if refresh fails
â”‚
â”œâ”€â”€ Other HTTP errors:
â”‚   â”œâ”€â”€ Passed to calling function
â”‚   â”œâ”€â”€ Usually shows toast notification
â”‚   â””â”€â”€ Updates loading state to false
â”‚
â””â”€â”€ Network errors:
    â”œâ”€â”€ Shows generic error message
    â””â”€â”€ Allows user to retry operation
```

### 2. Form Validation Flow
```
Form Submission (Add Expense)
â”œâ”€â”€ validateForm() checks all fields:
â”‚   â”œâ”€â”€ Amount: Must be valid number > 0
â”‚   â”œâ”€â”€ Category: Must be selected
â”‚   â”œâ”€â”€ Description: Must not be empty
â”‚   â””â”€â”€ Payment Type: Must be selected
â”‚
â”œâ”€â”€ If validation fails:
â”‚   â”œâ”€â”€ Sets formErrors state with specific messages
â”‚   â”œâ”€â”€ Prevents form submission
â”‚   â””â”€â”€ Shows error messages under form fields
â”‚
â”œâ”€â”€ If validation passes:
â”‚   â”œâ”€â”€ Clears formErrors state
â”‚   â”œâ”€â”€ Proceeds with API call
â”‚   â””â”€â”€ Shows success/error based on API response
â”‚
â””â”€â”€ Form reset only happens after successful submission
```

## ðŸ“Š State Management Flow

### Redux State Updates
```
Action Dispatched
â”œâ”€â”€ Reducer processes action in respective slice
â”œâ”€â”€ State update triggers component re-renders
â”œâ”€â”€ Components using useSelector automatically update
â””â”€â”€ UI reflects new state immediately

Auth State Updates:
â”œâ”€â”€ setLoading(boolean) â†’ Shows/hides loading indicators
â”œâ”€â”€ setIsAuthenticated(boolean) â†’ Controls access to protected routes
â””â”€â”€ setUser({id, username, email}) â†’ Updates user profile data

Expense State Updates:
â”œâ”€â”€ setLoading(string) â†’ Controls specific loading states
â”œâ”€â”€ setExpenses(array) â†’ Replaces entire expenses array
â”œâ”€â”€ addExpense(object) â†’ Prepends new expense to array
â””â”€â”€ removeExpense(id) â†’ Filters out expense with matching ID
```

This comprehensive data flow documentation covers all major scenarios and interactions in the Expense Manager application, from authentication to expense management, including error handling and state management patterns.